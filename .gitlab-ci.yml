stages:
  - build
  - test
  - deploy

build-frontend-job:
  stage: build
  image: node:fermium-slim
  script:
    - echo "Compiling the React app..."
    - cd frontend
    - npm ci
    - npm run build

build-backend-job:
  stage: build
  image: maven:latest
  script:
    - echo "Compiling the Spring boot app..."
    - cd backend
    - mvn clean install -D skipTests

unit-tests-frontend:
  stage: test
  script:
    - cd frontend
    - echo "Pending to add tests on the frontend project..."

unit-tests-backend:
  stage: test
  script:
    - cd backend
    - echo "Pending to add tests on the frontend project..."

deploy-frontend-job:
  stage: deploy
  image: registry.gitlab.com/gitlab-org/cloud-deploy/aws-base:latest
  script:
    - cd infra
    - yarn deploy-frontend
    - echo "Web App successfully deployed."

deploy-backend-job:
  stage: deploy
  image: registry.gitlab.com/gitlab-org/cloud-deploy/aws-base:latest
  script:
    - cd infra
    - yarn start-session
    - cd /grupo-01/backend
    - ./deploy.sh
    - echo "API successfully deployed."